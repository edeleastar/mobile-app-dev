 <!DOCTYPE html>
 <html>
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
   
     <title> Lab-07 </title>
   
     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
     <link rel="stylesheet" href="./style/semantic/css/semantic.min.css" type="text/css">  
     <link rel="stylesheet" href="./style/custom/main.css" type="text/css"> 
   
     <script src="./style/custom/jquery-2.1.0.min.js"></script> 
     <script src="./style/custom/jquery.address-1.6.min.js"></script>
     <script src="./style/semantic/javascript/semantic.min.js"></script>
   
     <link rel="stylesheet" href="./style/highlight/school_book.css">
     <script src="./style/highlight/highlight.pack.js"></script> 
     <script>hljs.initHighlightingOnLoad();</script>
   
     <script src="./style/custom/common.js"> </script> 
     <script src="./style/custom/main.js"> </script> 
  </head>
  <body>
  <nav class="ui fixed top pointing borderless inverted menu">
    <header class="header item"> <a href="../index.html">Android App Structure</a></header>
    <div class="right tab-menu menu">
          <a class="item" data-tab="Lab-07"> Lab-07 </a>
          <a class="item" data-tab="01"> 01 </a>
          <a class="item" data-tab="02"> 02 </a>
          <a class="item" data-tab="03"> 03 </a>
          <a class="item" data-tab="04"> 04 </a>
          <a class="item" data-tab="05"> 05 </a>
          <a class="item" data-tab="06"> 06 </a>
          <a class="item" data-tab="07"> 07 </a>
          <a class="item" data-tab="Exercises"> Exercises </a>
    </div>
  </nav>

  <br>

	  <section data-tab="Lab-07" class="ui tab stacked moodle-book segment">
	     <h1>Objectives</h1>
<ul>
<li>Enable menus to support navigation between Donate and Report</li>
<li>Introduce an Application Object to host list of donations</li>
<li>Introduce an Adapter to render this list</li>
</ul>
	  </section>
	  <section data-tab="01" class="ui tab stacked moodle-book segment">
	     <h1>Package Name</h1>
<p>This is a version1 of the donation-android app:</p>
<ul>
<li><a href="archives/donation-android-v1.zip">donation-android-v1.zip</a></li>
</ul>
<p>This version is a little misconfigured - we have a leftover the package name 'com.example.donation' form he project generation wizard. This can be changed by editing the AndridManifext.xml file:</p>
<pre><code class="xml">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;app.donation&quot;
    android:versionCode=&quot;1&quot;
    android:versionName=&quot;1.0&quot; &gt;
</code></pre>

<p>Once you save this - it would regenerate the correct 'gen' files. Delete the old one as we no longet need it (com.example.donation)</p>
<p>We should also take this opportunity to change the name of the 'donation' package to 'app.donation'. Unlike Play, android does not like packages with a single 'segment'</p>
<p><img alt="" src="img/02.png"></p>
	  </section>
	  <section data-tab="02" class="ui tab stacked moodle-book segment">
	     <h1>Menu</h1>
<p>In Donation, introduce the following menu event handler:</p>
<pre><code class="java">  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
      case R.id.action_settings: Toast toast = Toast.makeText(this, &quot;Settings Selected&quot;, Toast.LENGTH_SHORT);
                                 toast.show();
                                 break;
    }
    return true;
  }
</code></pre>

<p>We already have a menu called 'donate.xml' in the res folder. Add a new menu item like the one shown below:</p>
<pre><code class="xml">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;

    &lt;item
        android:id=&quot;@+id/action_settings&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/menuSettings&quot;/&gt;

    &lt;item
        android:id=&quot;@+id/menuReport&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/menuReport&quot;/&gt;    

&lt;/menu&gt;
</code></pre>

<p>This will require a new String in the strings.xml file:</p>
<pre><code class="xml">    &lt;string name=&quot;menuReport&quot;&gt;Report&lt;/string&gt;
</code></pre>

<p>Run the app and when you press the menu hardware button and select 'settings', you should see the toast message appear.</p>
	  </section>
	  <section data-tab="03" class="ui tab stacked moodle-book segment">
	     <h1>Reports Activity</h1>
<p>Design a new layout - called Report - to look something like this:</p>
<p><img alt="" src="img/01.png"></p>
<p>This is the layout file itself:</p>
<pre><code class="xml">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;
    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;
    tools:context=&quot;.Test&quot; &gt;

    &lt;TextView
        android:id=&quot;@+id/reportTitle&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_alignParentTop=&quot;true&quot;
        android:text=&quot;@string/reportTitle&quot;
        android:textAppearance=&quot;?android:attr/textAppearanceLarge&quot; /&gt;

    &lt;ListView
        android:id=&quot;@+id/reportList&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignLeft=&quot;@+id/reportTitle&quot;
        android:layout_below=&quot;@+id/reportTitle&quot; &gt;

    &lt;/ListView&gt;

&lt;/RelativeLayout&gt;
</code></pre>

<p>Introduce a new Class into app.activities to render this activity:</p>
<pre><code class="java">package app.activities;

import app.donation.R;
import app.main.DonationApp;
import android.app.Activity;
import android.os.Bundle;
import android.widget.ArrayAdapter;
import android.widget.ListView;

public class Report extends Activity
{
  ListView listView;

  static final String[] numbers = new String[] { 
      &quot;Amount, Pay method&quot;,
      &quot;10,     Direct&quot;,
      &quot;100,    PayPal&quot;,
      &quot;1000,   Direct&quot;,
      &quot;10,     PayPal&quot;,
      &quot;5000,   PayPal&quot;};

  @Override
  public void onCreate(Bundle savedInstanceState) 
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_report);

    listView = (ListView) findViewById(R.id.reportList);
    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,  android.R.layout.simple_list_item_1, numbers); 
    listView.setAdapter(adapter);
  }
} 
</code></pre>

<p>This will display a hard-coded lists of donations.</p>
<p>Change Donation activity to load this view when 'Report' selected from menu:</p>
<pre><code class="java">  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
      case R.id.menuReport : startActivity (new Intent(this, Report.class));
                             break;
    }
    return true;
  }
</code></pre>

<p>All of this will not work until you add the activity specification to the AndroidManifest.xml file:</p>
<pre><code class="xml">        &lt;activity
            android:name=&quot;app.activities.Report&quot;
            android:label=&quot;@string/donateTitle&quot; &gt;
        &lt;/activity&gt;
</code></pre>

<p>Try it all now - it should load.</p>
	  </section>
	  <section data-tab="04" class="ui tab stacked moodle-book segment">
	     <h1>Application Object</h1>
<p>In order to keep out application design coherent, we now bring in an 'Application' object.</p>
<p>Create a new package called 'app.main' and incorporate this class here:</p>
<pre><code class="java">package app.main;

import android.app.Application;
import android.util.Log;

public class DonationApp extends Application
{
  @Override
  public void onCreate()
  {
    super.onCreate();
    Log.v(&quot;Donation&quot;, &quot;Donation App Started&quot;);
  }
}
</code></pre>

<p>Application objects need to be references in the AndroidManifest.xml - at the very top as 'andorid:name'</p>
<pre><code class="xml">    &lt;application
        android:allowBackup=&quot;true&quot;
        android:icon=&quot;@drawable/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:theme=&quot;@style/AppTheme&quot; 
        android:name=&quot;app.main.DonationApp&quot;&gt;
</code></pre>

<p>Your project should now look like this:</p>
<p><img alt="" src="img/03.png"></p>
<p>Make sure the 'Donation App Started' appears in the logs to verify that it has actually been engaged correctly.</p>
	  </section>
	  <section data-tab="05" class="ui tab stacked moodle-book segment">
	     <h1>Donation Model</h1>
<p>Create a new package called 'models' and bring in this class here:</p>
<pre><code class="java">package app.models;

public class Donation
{
  public int    amount;
  public String method;

  public Donation (int amount, String method)
  {
    this.amount = amount;
    this.method = method;
  }
}
</code></pre>

<p>This is a revised version of DonationApp - which now manages a list of donations. It also centralises the 'makeDonation' event implementing it as a method. Replace your donation with this one:</p>
<pre><code class="java">package app.main;

import java.util.ArrayList;
import java.util.List;

import android.app.Application;
import android.util.Log;
import android.widget.Toast;
import app.models.Donation;

public class DonationApp extends Application
{
  public final int       target       = 10000;
  public int             totalDonated = 0;
  public List &lt;Donation&gt; donations    = new ArrayList&lt;Donation&gt;();

  public boolean newDonation(Donation donation)
  {
    boolean targetAchieved = totalDonated &gt; target;
    if (!targetAchieved)
    {
      donations.add(donation);
      totalDonated += donation.amount;
    }
    else
    {
      Toast toast = Toast.makeText(this, &quot;Target Exceeded!&quot;, Toast.LENGTH_SHORT);
      toast.show();
    }
    return targetAchieved;
  }

  @Override
  public void onCreate()
  {
    super.onCreate();
    Log.v(&quot;Donation&quot;, &quot;Donation App Started&quot;);
  }
}
</code></pre>
	  </section>
	  <section data-tab="06" class="ui tab stacked moodle-book segment">
	     <h1>Refactored Donate</h1>
<p>The Donate activity can now be completely re factored to make use of the DonationApp object.</p>
<pre><code class="java">package app.activities;

import app.donation.R;
import app.main.DonationApp;
import app.models.Donation;
import android.os.Bundle;
import android.app.Activity;
import android.content.Intent;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.RadioGroup;
import android.widget.NumberPicker;
import android.widget.ProgressBar;
import android.widget.TextView;

public class Donate extends Activity
{
  private RadioGroup   paymentMethod;
  private ProgressBar  progressBar;
  private NumberPicker amountPicker;
  private TextView     amountText;
  private TextView     amountTotal;
  private DonationApp app;

  @Override
  protected void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_donate);

    app = (DonationApp) getApplication();

    paymentMethod = (RadioGroup)   findViewById(R.id.paymentMethod);
    progressBar   = (ProgressBar)  findViewById(R.id.progressBar);
    amountPicker  = (NumberPicker) findViewById(R.id.amountPicker);
    amountText    = (TextView)     findViewById(R.id.amountText);
    amountTotal   = (TextView)     findViewById(R.id.amountTotal);

    amountPicker.setMinValue(0);
    amountPicker.setMaxValue(1000);
    progressBar.setMax(app.target);
  }

  @Override
  public boolean onCreateOptionsMenu(Menu menu)
  {
    getMenuInflater().inflate(R.menu.donate, menu);
    return true;
  }

  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
      case R.id.menuReport : startActivity (new Intent(this, Report.class));
                             break;
    }
    return true;
  }

  public void donateButtonPressed (View view) 
  {
    String method = paymentMethod.getCheckedRadioButtonId() == R.id.PayPal ? &quot;PayPal&quot; : &quot;Direct&quot;;
    int donatedAmount =  amountPicker.getValue();
    if (donatedAmount == 0)
    {
      String text = amountText.getText().toString();
      if (!text.equals(&quot;&quot;))
        donatedAmount = Integer.parseInt(text);
    }
    if (donatedAmount &gt; 0)
    {
      app.newDonation(new Donation(donatedAmount, method));
      progressBar.setProgress(app.totalDonated);
      String totalDonatedStr = &quot;$&quot; + app.totalDonated;
      amountTotal.setText(totalDonatedStr);
    }
   }
}
</code></pre>

<p>Replace your version with this and execute it.</p>
<p>Look carefully at the changes to this version over the v1 attempt.</p>
	  </section>
	  <section data-tab="07" class="ui tab stacked moodle-book segment">
	     <h1>Refactored Report</h1>
<p>We now rework Report to render the actual donations - held in the DonationApp list.</p>
<p>First some layout additions. Include these new string in strings.xml</p>
<pre><code>    &lt;string name=&quot;defaultAmount&quot;&gt;00&lt;/string&gt;
    &lt;string name=&quot;defaultMethod&quot;&gt;N/A&lt;/string&gt;
</code></pre>

<p>This is a new layout - to be called 'row_donate.xml'. Place this in the 'layout' folder.</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot; &gt;

    &lt;TextView
        android:id=&quot;@+id/row_amount&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_alignParentTop=&quot;true&quot;
        android:layout_marginLeft=&quot;48dp&quot;
        android:layout_marginTop=&quot;20dp&quot;
        android:text=&quot;@string/defaultAmount&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/row_method&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignBaseline=&quot;@+id/row_amount&quot;
        android:layout_alignBottom=&quot;@+id/row_amount&quot;
        android:layout_marginLeft=&quot;106dp&quot;
        android:layout_toRightOf=&quot;@+id/row_amount&quot;
        android:text=&quot;@string/defaultMethod&quot; /&gt;

&lt;/RelativeLayout&gt;
</code></pre>

<p>Finally, rework Report class to remove the hard coded values - and use a different 'adapter'</p>
<pre><code class="java">package app.activities;

import java.util.List;
import app.donation.R;
import app.main.DonationApp;
import android.app.Activity;
import android.content.Context;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.TextView;
import app.models.Donation;

public class Report extends Activity
{
  private ListView    listView;
  private DonationApp app;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_report);

    app = (DonationApp) getApplication();

    listView = (ListView) findViewById(R.id.reportList);
    DonationAdapter adapter = new DonationAdapter (this, app.donations);
    listView.setAdapter(adapter);
  }
}
</code></pre>

<p>This is the new adapter - DonationAdapter. You can place this at the end of the Report class (outside the closing brace) if you like:</p>
<pre><code class="java">class DonationAdapter extends ArrayAdapter&lt;Donation&gt;
{
  private Context        context;
  public  List&lt;Donation&gt; donations;

  public DonationAdapter(Context context, List&lt;Donation&gt; donations)
  {
    super(context, R.layout.row_donate, donations);
    this.context   = context;
    this.donations = donations;
  }

  @Override
  public View getView(int position, View convertView, ViewGroup parent)
  {
    LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);

    View     view       = inflater.inflate(R.layout.row_donate, parent, false);
    Donation donation   = donations.get(position);
    TextView amountView = (TextView) view.findViewById(R.id.row_amount);
    TextView methodView = (TextView) view.findViewById(R.id.row_method);

    amountView.setText(&quot;&quot; + donation.amount);
    methodView.setText(donation.method);

    return view;
  }

  @Override
  public int getCount()
  {
    return donations.size();
  }
}
</code></pre>

<p>If all goes well - then you should be able to make donations, and and the see a list of the in the report activity.</p>
	  </section>
	  <section data-tab="Exercises" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<p>Project so far:</p>
<ul>
<li><a href="archives/donation-android-v2.zip">donation-android-v2</a></li>
</ul>
<h2>Exercise 1</h2>
<p>Run the app and insert amounts of varying lengths (1, 222, 23, 2323). Note that the second column - payment method -may be displayed at different positions. If this happens, fix it.</p>
<p>Hint: each row is laid out by a row_donate.xml layout. The easiest way to fix this would be to experiment with they layout, and have the text fields aligned with the edges and not with eachother.</p>
<h2>Exercise 2</h2>
<p>When a donation is accepted, set the amount on screen to 0 (in both picker and text field).</p>
<h2>Exercise 3</h2>
<p>When you navigate from the Donate activity to reports, there will be no menu available. Bring in a menu, with two options 'Settings' and 'Donate' - Donate should bring you back to the donate screen.</p>
<h2>Exercise 4</h2>
<p>Introduce a new welcome screen - which should display a greeting + give the user 2 options (as simple buttons)</p>
<ul>
<li>Signup</li>
<li>Login</li>
</ul>
<p>When Login is pressed, the app should take you directly to the Donate activity (for the moment).</p>
<h2>Exercise 5</h2>
<p>Introduce a Signup Activity, which should present the user with:</p>
<ul>
<li>First Name</li>
<li>Last Name</li>
<li>Email</li>
<li>
<p>Password</p>
</li>
<li>
<p>a 'Register' button.</p>
</li>
</ul>
<p>Pressing Register should take you directly to "Donate" activity. Also, refactor the Welcome screen such that the 'signup' button takes you to this screen.</p>
<h2>Exercise 6:</h2>
<p>Introduce a Login activty, which should just look for</p>
<ul>
<li>email</li>
<li>
<p>password</p>
</li>
<li>
<p>a 'Login' button</p>
</li>
</ul>
<p>Pressing Login should take you directly to "Donate" activity.</p>
<h2>Exercise 7</h2>
<p>Bring in a new menu option - 'logout'. It should take you to the welcome screen, and should be available from the donate and report activities.</p>
<h2>Exercise 8</h2>
<p>Introduce a 'User' into the models package to represent the user in the usual way. Maintain a list of Users in the DonationApp object. Whenever anyone registers, then create a new User object in this list.</p>
<h2>Exercise 9</h2>
<p>Implement the Login activity, to now only let users in to Donate if they are registered (i.e. a matching email + password in the list of users maintained by DonationApp)</p>
	  </section>
  <div class="ui fixed bottom borderless menu">'
    <div class="ui small item"> 
    <p id="footertext">
    Prepared by  Eamonn de Leastar (edeleastar@wit.ie). Except where otherwise noted, this content is licensed under a  
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/" 
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>   
    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-49703418-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>  </body>
 </html>